# check_server_status.py
# Script to check the status of all WebSphere Application Servers

import sys

# Get the list of all servers
servers = AdminConfig.list('Server').splitlines()

running_servers = []
stopped_servers = []

# Check the status of each server
for server in servers:
    serverName = AdminConfig.showAttribute(server, 'name')
    nodeName = AdminControl.getAttribute(server, 'nodeName')
    server_status = AdminControl.queryNames(f'node={nodeName},type=Server,name={serverName},*')

    if server_status:
        running_servers.append(f"{serverName} on {nodeName}")
    else:
        stopped_servers.append(f"{serverName} on {nodeName}")

print("Running servers: {}".format(", ".join(running_servers)))
print("Stopped servers: {}".format(", ".join(stopped_servers)))

if stopped_servers:
    print("Exiting with code 1 due to stopped servers.")
    sys.exit(1)
else:
    print("All servers are running. Exiting with code 0.")
    sys.exit(0)
